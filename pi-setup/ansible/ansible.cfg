# Ansible Configuration for Raspberry Pi K3s Cluster
# Optimized for reliability over WiFi and during heavy operations (K3s install)

[defaults]
# Inventory file location
inventory = inventory.ini

# Default remote user
remote_user = admin

# Host key checking (accept new keys automatically for new Pis)
host_key_checking = False

# Forks - run tasks in parallel (limited for Pi stability)
forks = 5

# Gathering facts timeout (Pi can be slow during heavy operations)
gathering = smart
fact_caching = memory
fact_caching_timeout = 3600

# Retry files (useful for debugging failed tasks)
retry_files_enabled = True
retry_files_save_path = ~/.ansible-retry

# Increase timeout for slow operations
timeout = 60

# Callback plugins for better output
# Note: community.general.yaml was removed in v12.0.0
# Use ansible.builtin.default with result_format=yaml instead (ansible-core 2.13+)
stdout_callback = default
callback_result_format = yaml
callbacks_enabled = timer, profile_tasks

# Interpreter discovery
interpreter_python = auto_silent

[ssh_connection]
# SSH pipelining (faster but may cause issues with sudo)
pipelining = True

# SSH connection timeout (seconds) - increased for WiFi reliability
timeout = 60

# SSH arguments for reliability
ssh_args = -o ControlMaster=auto -o ControlPersist=60s -o ConnectTimeout=30 -o ServerAliveInterval=15 -o ServerAliveCountMax=3 -o StrictHostKeyChecking=accept-new

# Retries for SSH connections
retries = 5

# Control path for connection reuse
control_path = %(directory)s/%%h-%%r

[persistent_connection]
# Connection timeout for persistent connections
connect_timeout = 60

# Command timeout
command_timeout = 60

# Retry timeout
connect_retry_timeout = 30

[privilege_escalation]
# Become settings (sudo)
become = True
become_method = sudo
become_user = root
become_ask_pass = False
