# kube-world Central Configuration
# ================================
# This is the single source of truth for all configurable parameters.
# All other configs reference or are templated from this file.
#
# USAGE:
#   - Update values here before running bootstrap.sh
#   - Secrets (marked [SOPS]) should be encrypted before committing
#   - Run: yq eval '.network.wifi.ssids[0].password = "newpass"' -i config.yaml
#
# RELATED FILES:
#   - inventory/hardware.yaml: Auto-generated from nodes/iot_devices sections
#   - pi-setup/cloud-init/network-config.yaml: Uses network.wifi settings
#   - infrastructure/terraform.tfvars: Uses cloud/dns/backup sections
#   - secrets/.sops.yaml: Encryption config for [SOPS] fields
#
---
apiVersion: kube-world.io/v1
kind: ClusterConfig
metadata:
  name: kube-world
  version: "1.0.0"
  lastUpdated: "2026-01-17"

#===============================================================================
# Deployment Settings
#===============================================================================
deployment:
  # Target mode: dev | prod
  mode: dev
  
  # Primary platform: mac-arm64 | mac-amd64 | pi | cloud
  # Set to 'auto' for auto-detection
  platform: auto
  
  # Kubernetes distribution versions
  versions:
    k3s: "v1.29.0+k3s1"
    rancher: "2.13.1"
    helm: "3.14.0"
    
  # Feature flags
  features:
    rancher: true
    fleet_gitops: true
    velero_backups: true
    kyverno_policies: true
    home_assistant: true
    monitoring: false  # Future: Prometheus/Grafana stack

#===============================================================================
# Network Configuration
#===============================================================================
network:
  # Home network settings (used for Pi deployments)
  home:
    subnet: "192.168.1.0/24"
    gateway: "192.168.1.1"
    dns:
      - "8.8.8.8"
      - "8.8.4.4"
    # DNS search domain
    search_domain: "local"
  
  # Static IP assignments for nodes
  # These should also be reserved in your router's DHCP settings
  static_ips:
    pi5-master-1: "192.168.1.100"
    pi5-worker-1: "192.168.1.101"
    pi5-worker-2: "192.168.1.102"
  
  # WiFi configuration for Pi headless setup
  # NOTE: Passwords are sensitive - consider using SOPS encryption
  # See: secrets/README.md for encryption instructions
  wifi:
    enabled: true
    # Priority order - first available will be used
    ssids:
      - name: "YourNetworkName"           # [UPDATE] Your primary WiFi
        password: "CHANGE_ME"             # [SOPS] Encrypt this value
        priority: 10
      - name: "YourBackupNetwork"         # [UPDATE] Backup WiFi (optional)
        password: "CHANGE_ME"             # [SOPS] Encrypt this value
        priority: 5

#===============================================================================
# Node Inventory
#===============================================================================
# Primary compute nodes - sync with inventory/hardware.yaml
nodes:
  # Development machine
  macbook:
    id: "macbook-pro-m3"
    enabled: true
    role: management
    # Network interfaces - useful for identification but not critical
    # Dongle MACs are transient; built-in interfaces are stable
    network:
      # Built-in interfaces (stable)
      wifi_mac: "XX:XX:XX:XX:XX:XX"       # [UPDATE] en0 MAC address
      # Thunderbolt/USB adapters (transient - for reference only)
      # These may change with different dongles
      thunderbolt_macs:
        - "XX:XX:XX:XX:XX:XX"             # [UPDATE] en8/en9 if using
  
  # Raspberry Pi nodes
  pi_nodes:
    - id: "pi5-master-1"
      enabled: true
      role: master
      # MAC address for DHCP reservation
      mac: "XX:XX:XX:XX:XX:XX"            # [UPDATE] eth0 MAC from Pi
      ip: "192.168.1.100"
      # WiFi MAC (if using WiFi instead of ethernet)
      wifi_mac: "XX:XX:XX:XX:XX:XX"       # [UPDATE] wlan0 MAC from Pi

#===============================================================================
# IoT Device Inventory
#===============================================================================
# Home automation controllers - sync with inventory/hardware.yaml
iot_devices:
  zigbee:
    enabled: false                        # [UPDATE] Set true when purchased
    controller: "TBD"                     # e.g., "Sonoff Zigbee 3.0 USB Dongle Plus"
    vendor_id: "XXXX"                     # [UPDATE] from lsusb
    product_id: "XXXX"                    # [UPDATE] from lsusb
    integration: "zha"                    # zha | zigbee2mqtt
    
  zwave:
    enabled: false                        # [UPDATE] Set true when purchased
    controller: "Home Assistant Connect ZWA-2"
    vendor_id: "10c4"
    product_id: "ea60"
    integration: "zwave_js"
    
  thread:
    enabled: false                        # [UPDATE] Set true when purchased
    controller: "Home Assistant Connect ZBT-2"
    vendor_id: "XXXX"                     # [UPDATE] from lsusb
    product_id: "XXXX"                    # [UPDATE] from lsusb

#===============================================================================
# Cloud Provider Configuration
#===============================================================================
# Cloud-agnostic settings - populate based on your chosen provider
cloud:
  # Primary provider: aws | gcp | azure | none
  primary_provider: none
  
  # AWS Configuration
  aws:
    enabled: false
    region: "us-east-1"
    # Credentials should be in ~/.aws/credentials or environment variables
    # DO NOT store credentials in this file
    
  # GCP Configuration  
  gcp:
    enabled: false
    project_id: ""                        # [UPDATE] Your GCP project ID
    region: "us-central1"
    # Credentials via GOOGLE_APPLICATION_CREDENTIALS env var
    
  # Azure Configuration
  azure:
    enabled: false
    subscription_id: ""                   # [UPDATE] Your Azure subscription
    location: "eastus"
    resource_group: "kube-world-rg"

#===============================================================================
# DNS Configuration
#===============================================================================
dns:
  # Domain for your services
  domain: ""                              # [UPDATE] e.g., "home.yourdomain.com"
  
  # DNS provider: route53 | clouddns | azure_dns | cloudflare | none
  provider: none
  
  # Provider-specific settings
  route53:
    zone_id: ""                           # [UPDATE] If using Route53
    
  clouddns:
    zone_name: ""                         # [UPDATE] If using Cloud DNS
    
  # Local DNS (for Pi/home network)
  local:
    # Use mDNS for local discovery
    mdns_enabled: true
    # Local hostnames
    hostnames:
      rancher: "rancher.local"
      home_assistant: "homeassistant.local"

#===============================================================================
# Backup Configuration
#===============================================================================
backup:
  # Backup provider: s3 | gcs | azure_blob | minio | none
  provider: minio  # Default to local MinIO for self-hosted
  
  # Schedule (cron format)
  schedule: "0 2 * * *"  # Daily at 2 AM
  
  # Retention
  retention:
    daily: 7
    weekly: 4
    monthly: 3
  
  # S3/MinIO settings
  s3:
    bucket: "kube-world-backups"
    region: "us-east-1"
    # For MinIO, use local endpoint
    endpoint: "http://minio.minio-system.svc:9000"
    
  # GCS settings
  gcs:
    bucket: "kube-world-backups"
    project_id: ""                        # [UPDATE] If using GCS

#===============================================================================
# Security Configuration
#===============================================================================
security:
  # SOPS encryption
  sops:
    # Age public key for encryption
    # Generate with: age-keygen -o secrets/age.key
    age_public_key: ""                    # [UPDATE] Your age public key
    
  # SSH key for Pi access
  ssh:
    # Path to public key (will be added to Pi authorized_keys)
    public_key_path: "~/.ssh/id_ed25519.pub"
    
  # TLS certificates
  tls:
    # cert-manager issuer: letsencrypt-staging | letsencrypt-prod | selfsigned
    issuer: selfsigned
    # Email for Let's Encrypt (required for letsencrypt-*)
    email: ""                             # [UPDATE] Your email for LE

#===============================================================================
# Repository Settings
#===============================================================================
repository:
  # Git repository URL (for Fleet GitOps)
  url: "https://github.com/jasondashaer/kube-world.git"
  branch: "main"
  
  # Paths to watch for GitOps
  paths:
    - "apps/"
    - "policies/"
    - "gitops/"
